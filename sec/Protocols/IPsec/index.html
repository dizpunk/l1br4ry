<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>IPsec - L1br4ry</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../../l1br4ry.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "IPsec";
        var mkdocs_page_input_path = "sec/Protocols/IPsec.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> L1br4ry
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Dev</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" >Languages</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../dev/Languages/python/">Python</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../dev/Languages/javascript/">Javascript</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../dev/Languages/powershell/">PowerShell</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Platforms</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" >Linux</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" >Package Managers</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../../dev/Platforms/linux/package%20managers/apt/">APT</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../../dev/Platforms/linux/package%20managers/brew/">Brew</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../../dev/Platforms/linux/package%20managers/dnf/">DNF</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../../dev/Platforms/linux/package%20managers/pacman/">Pacman</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Utilities</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../../dev/Platforms/linux/utilities/cat/">cat</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../../dev/Platforms/linux/utilities/exa/">exa</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../../dev/Platforms/linux/utilities/find/">find</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../../dev/Platforms/linux/utilities/less/">less</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../../dev/Platforms/linux/utilities/ls/">ls</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../../dev/Platforms/linux/utilities/most/">most</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../../dev/Platforms/linux/utilities/rar/">rar</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../../dev/Platforms/linux/utilities/sort/">sort</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../../dev/Platforms/linux/utilities/tar/">tar</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../../dev/Platforms/linux/utilities/unar/">unar</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../../dev/Platforms/linux/utilities/uniq/">uniq</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../../dev/Platforms/linux/utilities/zip/">zip</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Tools</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../dev/Tools/docker/">Docker</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Sec</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" >Protocols</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../SPF/">SPF</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../TLS/">TLS</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../VPN/">VPN</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../IKE/">IKE</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../DKIM/">DKIM</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">IPsec</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#transport-and-tunnel-modes">Transport and Tunnel modes</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ipsec-packets">IPsec packets</a>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../DMARC/">DMARC</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../DNSSEC/">DNSSEC</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../MTA-STS/">MTA-STS</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Frameworks</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../Frameworks/CIS/">CIS</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../Frameworks/CSA/">CSA</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../Frameworks/ATT%26CK/">ATT&CK</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../Frameworks/NIST-CSF/">NIST-CSF</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../Frameworks/DiamondModel/">DiamondModel</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../Frameworks/PiramidOfPain/">PiramidOfPain</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../Frameworks/CyberKillChain/">CyberKillChain</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../Frameworks/UnifiedKillChain/">UnifiedKillChain</a>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">L1br4ry</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Sec</li>
          <li class="breadcrumb-item">Protocols</li>
      <li class="breadcrumb-item active">IPsec</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="internet-protocol-security">Internet Protocol Security</h1>
<p><strong>IPSec</strong>, short for <strong>Internet Protocol Security</strong>, is a suite of protocols and cryptographic techniques used to secure and protect communication over IP networks. It provides a framework for ensuring the confidentiality, integrity, and authenticity of data transmitted between devices in a network, typically over the Internet.</p>
<p>IPSec operates at the network layer (Layer 3) of the OSI model and can be used to establish Virtual Private Networks (VPNs) or to secure individual network connections. It offers two main modes of operation: <strong>Transport Mode</strong> and <strong>Tunnel Mode</strong>.</p>
<p>Here's how IPSec works:</p>
<ol>
<li>
<p><strong>Authentication and Key Exchange</strong>:
   Before secure communication can begin, the two devices (or endpoints) that want to communicate need to establish a secure channel and exchange cryptographic keys. This is usually done using protocols like the Internet Key Exchange (IKE) protocol. IKE negotiates the encryption algorithm, authentication method, and other security parameters to be used during the communication.</p>
</li>
<li>
<p><strong>Encapsulation and Encryption</strong>:
   Once the keys and security parameters are established, the data to be transmitted is encapsulated within an IPSec packet. This encapsulation involves adding an IPSec header to the original IP packet. The IPSec header contains information needed for the secure transmission, such as the security parameters, sequence numbers, and other metadata.</p>
</li>
<li>
<p><strong>Encryption and Authentication</strong>:
   The encapsulated data is encrypted to ensure its confidentiality. Encryption algorithms like AES (Advanced Encryption Standard) are commonly used for this purpose. Additionally, the data is authenticated using HMAC (Hash-based Message Authentication Code) algorithms to detect any tampering or unauthorized changes during transmission.</p>
</li>
<li>
<p><strong>Transmission and Decryption</strong>:
   The IPSec-protected packet is then transmitted over the network. Routers and firewalls along the route can apply IPSec policies to enforce security requirements. When the packet reaches the receiving endpoint, it's decrypted using the appropriate cryptographic keys and algorithms. The authenticity of the packet is verified through the authentication information added in the IPSec header.</p>
</li>
<li>
<p><strong>Decapsulation</strong>:
   Once the packet is decrypted and authenticated, the original IP packet is extracted from the IPSec packet. This process involves removing the IPSec header and any additional encapsulation layers.</p>
</li>
</ol>
<p>By implementing these steps, IPSec ensures that data integrity is maintained, data confidentiality is preserved, and the authenticity of the communication partners is verified. It's worth noting that while IPSec provides a strong level of security, proper configuration and management are crucial to ensure its effectiveness.</p>
<h2 id="transport-and-tunnel-modes">Transport and Tunnel modes</h2>
<p>IPSec offers two main modes of operation: <strong>Transport Mode</strong> and <strong>Tunnel Mode</strong>. These modes determine how IPSec is applied to the communication between two devices (or endpoints) and how the original IP packets are protected and secured.</p>
<ol>
<li><strong>Transport Mode</strong>:
   In Transport Mode, IPSec secures the payload of the original IP packet while leaving the original IP header intact. This mode is typically used when the communication is between two endpoints, and the devices want to secure the data being transmitted without changing the original source and destination IP addresses.</li>
</ol>
<p>Here's how Transport Mode works:</p>
<ul>
<li>The original IP packet's payload is encrypted and authenticated.</li>
<li>An additional IPSec header is added to the encrypted payload, containing information related to IPSec security associations.</li>
<li>The encrypted packet is then sent over the network with the original IP header still visible.</li>
</ul>
<p>Transport Mode is commonly used for end-to-end communication, such as securing VoIP calls or secure communications within a private network.</p>
<ol>
<li><strong>Tunnel Mode</strong>:
   In Tunnel Mode, IPSec encapsulates the entire original IP packet within a new IPSec-protected packet. This new packet, often referred to as the "tunnel," has its own IP header, which means the original source and destination IP addresses are now the endpoints of the tunnel. This mode is used when communication needs to be secured between two networks or when there is a need to hide the original source and destination IP addresses.</li>
</ol>
<p>Here's how Tunnel Mode works:</p>
<ul>
<li>The original IP packet (including its IP header and payload) is encrypted and authenticated.</li>
<li>An IPSec header is added to the encrypted packet, containing information about the IPSec security associations and the new tunnel IP header.</li>
<li>A new outer IP header is added to the packet, specifying the source and destination of the tunnel endpoints.</li>
</ul>
<p>Tunnel Mode is often used for creating Virtual Private Networks (VPNs), connecting remote offices or individual devices to a central network, and securing communication between different networks over the Internet.</p>
<p>In summary, Transport Mode encrypts and secures the data within the original IP packet, while Tunnel Mode encapsulates the entire original IP packet within a new IPSec-protected packet. The choice between these modes depends on the specific security requirements and the nature of the communication: whether it's end-to-end between devices or between networks.</p>
<h2 id="ipsec-packets">IPsec packets</h2>
<p>Certainly! Let's consider an example scenario where two devices, Device A and Device B, are communicating using IPSec in both Transport Mode and Tunnel Mode.</p>
<p><strong>1. IPSec Transport Mode:</strong></p>
<p>In Transport Mode, only the payload of the original IP packet is encrypted and authenticated. The original IP header remains intact.</p>
<pre><code>Original IP Header
+-------------------------------+
| Version |  IHL  |  DSCP | ECN |
+-------------------------------+
| Total Length | Identification |
+-------------------------------+
| Flags | Fragment Offset       |
+-------------------------------+
| TTL   | Protocol  |  Header   |
|       |           |  Checksum |
+-------------------------------+
| Source IP Address             |
+-------------------------------+
| Destination IP Address        |
+-------------------------------+
|   IPSec Header                |
| +---------------------------+ |
| | Next Header |  Payload    | |
| |             |  Length     | |
| +---------------------------+ |
| |  Security Parameters      | |
| | +-----------------------+ | |
| | |   ... (SPI, Seq #,    | | |
| | |   Encryption, Auth,   | | |
| | |   Key Exchange Params)| | |
| | +-----------------------+ | |
| +---------------------------+ |
+-------------------------------+
|   Encrypted Payload           |
| +---------------------------+ |
| |         Data              | |
| +---------------------------+ |
+-------------------------------+
</code></pre>
<ul>
<li>
<p>The "Original IP Header" includes various fields such as the version, header length, DSCP (Differentiated Services Code Point), ECN (Explicit Congestion Notification), identification, flags, fragment offset, TTL (Time to Live), protocol, header checksum, source IP address, and destination IP address. This is the standard IP header of the original packet.</p>
</li>
<li>
<p>The "IPSec Header" follows the original IP header. It includes fields like "Next Header" (indicating the type of payload following the IPSec header) and "Payload Length" (length of the IPSec payload, excluding the header).</p>
</li>
<li>
<p>Within the "IPSec Header," there are "Security Parameters" which encompass information such as Security Parameter Index (SPI), sequence number, encryption algorithm, authentication algorithm, and other key exchange parameters. These parameters are necessary for securing and authenticating the communication.</p>
</li>
<li>
<p>The "Encrypted Payload" contains the actual data of the original packet. This data has been encrypted to ensure confidentiality and integrity during transmission.</p>
</li>
</ul>
<p><strong>2. IPSec Tunnel Mode:</strong></p>
<p>In Tunnel Mode, the entire original IP packet, including its header and payload, is encapsulated within a new IPSec-protected packet with its own IP header.</p>
<pre><code>Original IP Header
+-------------------------------+
| Version |  IHL  |  DSCP | ECN |
+-------------------------------+
| Total Length | Identification |
+-------------------------------+
| Flags | Fragment Offset       |
+-------------------------------+
| TTL   | Protocol  |  Header   |
|       |           |  Checksum |
+-------------------------------+
| Source IP Address             |
+-------------------------------+
| Destination IP Address        |
+-------------------------------+
|   New IP Header (Tunnel)      |
| +---------------------------+ |
| | Version | IHL | DSCP | ECN  |
| +---------------------------+ |
| | Total Length|Identification |
| +---------------------------+ |
| | Flags | Fragment Offset   | |
| +---------------------------+ |
| | TTL  | Protocol  | Header   |
| |      |           | Checksum |
| +---------------------------+ |
| | Source IP (Tunnel Source) | |
| +---------------------------+ |
| | Destination IP (Tunnel    | |
| | Destination)              | |
| +---------------------------+ |
|   IPSec Header                |
| +---------------------------+ |
| | Next Header |  Payload    | |
| |             |  Length     | |
| +---------------------------+ |
| |  Security Parameters      | |
| | +-----------------------+ | |
| | |   ... (SPI, Seq #,    | | |
| | |   Encryption, Auth,   | | |
| | |   Key Exchange Params)| | |
| | +-----------------------+ | |
| +---------------------------+ |
+-------------------------------+
|   Encrypted Payload           |
| +---------------------------+ |
| |         Data              | |
| +---------------------------+ |
+-------------------------------+
</code></pre>
<ul>
<li>
<p>The "Original IP Header" remains the same as in the Transport Mode representation, including all the standard fields of an IP header.</p>
</li>
<li>
<p>Following the "Original IP Header," there's a "New IP Header (Tunnel)" that encapsulates the entire original packet. This new IP header serves as the outer header for the tunnel. It includes fields like version, IHL, DSCP, ECN, total length, identification, flags, fragment offset, TTL, protocol, header checksum, source IP (the tunnel source), and destination IP (the tunnel destination).</p>
</li>
<li>
<p>After the "New IP Header (Tunnel)," there's the "IPSec Header," which contains similar fields already mentioned before: "Next Header," "Payload Length," and "Security Parameters."</p>
</li>
<li>
<p>The "Encrypted Payload" contains the actual data of the original packet, encrypted for confidentiality.</p>
</li>
</ul>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../DKIM/" class="btn btn-neutral float-left" title="DKIM"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../DMARC/" class="btn btn-neutral float-right" title="DMARC">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../DKIM/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../DMARC/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
