<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>MTA-STS - L1br4ry</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../../l1br4ry.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "MTA-STS";
        var mkdocs_page_input_path = "sec/Protocols/MTA-STS.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> L1br4ry
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Dev</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" >Languages</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../dev/Languages/python/">Python</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../dev/Languages/powershell/">PowerShell</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Platforms</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" >Linux</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" >Package Managers</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../../dev/Platforms/linux/package%20managers/apt/">APT</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../../dev/Platforms/linux/package%20managers/brew/">Brew</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../../dev/Platforms/linux/package%20managers/dnf/">DNF</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../../dev/Platforms/linux/package%20managers/pacman/">Pacman</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Utilities</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../../dev/Platforms/linux/utilities/cat/">cat</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../../dev/Platforms/linux/utilities/exa/">exa</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../../dev/Platforms/linux/utilities/find/">find</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../../dev/Platforms/linux/utilities/less/">less</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../../dev/Platforms/linux/utilities/ls/">ls</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../../dev/Platforms/linux/utilities/most/">most</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../../dev/Platforms/linux/utilities/rar/">rar</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../../dev/Platforms/linux/utilities/sort/">sort</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../../dev/Platforms/linux/utilities/tar/">tar</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../../dev/Platforms/linux/utilities/unar/">unar</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../../dev/Platforms/linux/utilities/uniq/">uniq</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../../dev/Platforms/linux/utilities/zip/">zip</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Tools</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../dev/Tools/docker/">Docker</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Sec</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" >Protocols</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../SPF/">SPF</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../TLS/">TLS</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../VPN/">VPN</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../IKE/">IKE</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../DKIM/">DKIM</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../IPsec/">IPsec</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../DMARC/">DMARC</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../DNSSEC/">DNSSEC</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">MTA-STS</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#policy-and-dns-record">Policy and DNS record</a>
    </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Frameworks</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../Frameworks/CIS/">CIS</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../Frameworks/CSA/">CSA</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../Frameworks/ATT%26CK/">ATT&CK</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../Frameworks/NIST-CSF/">NIST-CSF</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../Frameworks/DiamondModel/">DiamondModel</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../Frameworks/PiramidOfPain/">PiramidOfPain</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../Frameworks/CyberKillChain/">CyberKillChain</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../Frameworks/UnifiedKillChain/">UnifiedKillChain</a>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">L1br4ry</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Sec</li>
          <li class="breadcrumb-item">Protocols</li>
      <li class="breadcrumb-item active">MTA-STS</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="mail-transfer-agent-and-strict-transport-security">Mail Transfer Agent and Strict Transport Security</h1>
<p><strong>MTA-STS</strong> stands for <strong>Mail Transfer Agent Strict Transport Security</strong>. It is a security protocol designed to enhance the security of email communication by enforcing encryption and ensuring secure communication between email servers. MTA-STS helps prevent certain types of attacks, such as man-in-the-middle attacks, which can compromise the confidentiality and integrity of email messages.</p>
<p>Here's how MTA-STS works:</p>
<ol>
<li>
<p><strong>Enabling MTA-STS:</strong> A domain owner sets up MTA-STS for their domain by creating a policy file and hosting it on a specified HTTPS server. This policy file contains information about the domain's MTA-STS policy, including the MX (Mail Exchange) hosts that support TLS (Transport Layer Security) encryption.</p>
</li>
<li>
<p><strong>DNS Records:</strong> The domain owner also adds DNS records for their domain to indicate the existence of an MTA-STS policy and the location of the policy file. These DNS records are of type <code>TXT</code> and <code>_mta-sts</code>.</p>
</li>
<li>
<p><strong>Policy Discovery:</strong> When an email server wants to send an email to a recipient at a domain with an MTA-STS policy, it first performs a DNS lookup for the <code>_mta-sts</code> record of the recipient's domain. This record contains the URL of the policy file.</p>
</li>
<li>
<p><strong>Policy Fetching:</strong> The email server then retrieves the MTA-STS policy file using the provided URL over HTTPS. The policy file specifies which MX hosts are expected to support encrypted connections (TLS) for sending emails.</p>
</li>
<li>
<p><strong>Policy Enforcement:</strong> The sending email server establishes an encrypted connection (TLS) with the recipient's email server, using the MX hosts specified in the policy file. If the recipient's server does not support encrypted connections, the sending server should reject the email transmission or take appropriate action as per the policy.</p>
</li>
<li>
<p><strong>Caching and Timing:</strong> MTA-STS policies have a "max-age" directive that specifies how long the policy can be cached. This allows email servers to cache the policy and avoid repeated DNS and HTTPS requests for a certain period. The domain owner can also include a "preload" directive to signal to major email providers that their policy should be preloaded into email servers, providing more immediate protection.</p>
</li>
</ol>
<p>In summary, MTA-STS is a mechanism that helps ensure that email communication between servers is encrypted using TLS, thereby enhancing the security and privacy of email messages. It is part of ongoing efforts to improve the security of email communication and mitigate potential vulnerabilities and attacks.</p>
<h2 id="policy-and-dns-record">Policy and DNS record</h2>
<p>Example of an MTA-STS policy file and the corresponding DNS records for the domain "example.com":</p>
<ol>
<li><strong>MTA-STS Policy File (example.com.mta-sts.txt):</strong></li>
</ol>
<pre><code>version: STSv1
mode: enforce
max_age: 86400   # 1 day in seconds

mx: mx1.example.com
mx: mx2.example.com
</code></pre>
<p>In this example policy file:
- <code>version</code>: Specifies the version of the MTA-STS policy.
- <code>mode</code>: Sets the policy mode. "enforce" means that the policy should be enforced, requiring encrypted connections.
- <code>max_age</code>: Specifies how long the policy can be cached. Here, it's set to 1 day (86400 seconds).
- <code>mx</code>: Lists the MX hosts that should support TLS for sending emails.</p>
<ol>
<li>
<p><strong>DNS Records:</strong>
Add the following DNS records for the "example.com" domain:</p>
<ul>
<li>
<p><code>_mta-sts.example.com</code> TXT record:
  <code>v=STSv1; id=20230101T123456Z;</code>
  This record indicates the existence of an MTA-STS policy and includes the current date and time in UTC.</p>
</li>
<li>
<p><code>_smtp._tls.example.com</code> MX record:
  <code>10 mx1.example.com
  20 mx2.example.com</code>
  This record points to the MX hosts that are specified in the MTA-STS policy file. The "10" and "20" are the priority values, and "mx1.example.com" and "mx2.example.com" are the domain's mail exchange servers.</p>
</li>
</ul>
</li>
</ol>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../DNSSEC/" class="btn btn-neutral float-left" title="DNSSEC"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../../Frameworks/CIS/" class="btn btn-neutral float-right" title="CIS">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../DNSSEC/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../Frameworks/CIS/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
